<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Êú≠ÂπåÈü≥Ê®Ç‰πãÊóÖ 2026 | ÁπΩÁ¥õÊó•Á≥ª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&display=swap');
        
        :root {
            --cute-pink: #FF85A1;
            --cute-blue: #7FB3D5;
            --cute-green: #A2D9CE;
            --cute-yellow: #F7DC6F;
            --jp-ink: #2D3436;
        }

        body { 
            font-family: 'Noto Sans JP', 'Microsoft JhengHei', sans-serif; 
            -webkit-tap-highlight-color: transparent; 
            background-color: #FFF9F9;
            color: var(--jp-ink);
        }

        /* ÂèØÊÑõÈõ≤ÊúµËÉåÊôØ */
        .cloud-bg {
            background: radial-gradient(circle at 50% 100%, white 10%, #FFEDF1 100%);
            position: absolute; inset: 0; pointer-events: none; opacity: 0.5;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .glass { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); }
        
        .day-card { transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .day-card.active { 
            background: var(--cute-pink); 
            color: white; 
            transform: scale(1.1) rotate(-2deg); 
            box-shadow: 0 10px 25px -5px rgba(255, 133, 161, 0.5); 
        }

        @keyframes popIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .animate-pop { animation: popIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        #loading-overlay { display: none; position: fixed; inset: 0; background: rgba(255,255,255,0.9); z-index: 10000; flex-direction: column; align-items: center; justify-content: center; }
        #lightbox { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 10001; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        #lightbox img { max-width: 100%; max-height: 80vh; border-radius: 24px; border: 8px solid white; }

        .img-gradient { background: linear-gradient(to bottom, transparent 30%, rgba(0,0,0,0.6)); }
        .timeline-line { position: absolute; left: 24px; top: 0; bottom: 0; width: 4px; background: #FFE4E9; z-index: 0; border-radius: 2px; }
        .timeline-dot { position: absolute; left: 18px; width: 16px; height: 16px; border-radius: 50%; background: var(--cute-pink); border: 4px solid white; shadow: 0 2px 5px rgba(0,0,0,0.1); z-index: 10; margin-top: 4px; }
        
        .btn-tap { transition: transform 0.1s; cursor: pointer; }
        .btn-tap:active { transform: scale(0.92); }

        .tag-pink { background: #FFEDF1; color: #FF6B81; }
        .tag-blue { background: #EBF5FB; color: #3498DB; }
        .tag-green { background: #E9F7EF; color: #27AE60; }
    </style>
</head>
<body class="pb-36">

    <!-- Èö±ËóèËº∏ÂÖ•Ê°Ü -->
    <input type="file" id="banner-img-input" class="hidden" accept="image/*">
    <input type="file" id="event-img-input" class="hidden" accept="image/*">
    <input type="file" id="lib-file-input" class="hidden" accept="image/*">

    <!-- ËºâÂÖ•‰∏≠ÂãïÁï´ -->
    <div id="loading-overlay">
        <div class="w-12 h-12 border-4 border-pink-400 border-t-transparent rounded-full animate-spin mb-4"></div>
        <p class="text-xs font-bold text-pink-400 tracking-widest">ÂèØÊÑõÂä†Ëºâ‰∏≠...</p>
    </div>

    <!-- ÁáàÁÆ±È†êË¶Ω -->
    <div id="lightbox" onclick="closeLightbox()">
        <img id="lightbox-img" src="">
        <p class="mt-6 text-white font-bold text-sm bg-white/20 px-6 py-2 rounded-full backdrop-blur-md">ÈªûÊìä‰ªªÊÑèËôïÈóúÈñâ ‚ú®</p>
    </div>

    <!-- È†ÇÈÉ®Ê¨Ñ -->
    <header class="sticky top-0 z-50 glass border-b border-pink-50 px-6 py-4 flex justify-between items-center">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-[var(--cute-pink)] rounded-2xl flex items-center justify-center text-white text-lg shadow-md rotate-3">
                <i class="fas fa-heart"></i>
            </div>
            <div>
                <h1 class="text-base font-black text-gray-800 tracking-tight">Êú≠ÂπåÈü≥Ê®ÇÂ∞èÊóÖË°å</h1>
                <p class="text-[9px] font-bold text-pink-300 tracking-[0.2em] uppercase">Sapporo Music 2026</p>
            </div>
        </div>
        <div class="flex gap-2">
            <button onclick="resetData()" class="p-2 text-gray-200"><i class="fas fa-sync-alt text-sm"></i></button>
            <button id="edit-btn" onclick="toggleEdit()" class="btn-tap px-5 py-2 bg-[var(--jp-ink)] text-white rounded-2xl font-black text-[11px] shadow-lg">
                Á∑®ËºØË°åÁ®ã
            </button>
        </div>
    </header>

    <main class="max-w-md mx-auto p-4 space-y-6">
        
        <section id="content-itinerary" class="space-y-6 animate-pop">
            <!-- Â§©Ê∞£ËàáÂåØÁéá -->
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-white p-4 rounded-[2rem] shadow-sm flex items-center gap-3 border border-pink-50">
                    <div id="weather-icon" class="text-2xl text-blue-300"><i class="fas fa-snowflake"></i></div>
                    <div>
                        <p id="weather-display" class="text-xs font-black text-gray-700">ËÆÄÂèñ‰∏≠...</p>
                        <p class="text-[9px] text-blue-300 font-bold tracking-widest uppercase">‰ªäÊó•Â§©Ê∞£</p>
                    </div>
                </div>
                <div class="bg-white p-4 rounded-[2rem] shadow-sm border border-pink-50">
                    <div class="flex items-center gap-1">
                        <input type="number" id="jpy-input" oninput="convertCurrency('jpy')" placeholder="¬• Êó•Âπ£" class="w-full bg-gray-50 rounded-xl p-1.5 text-[10px] font-black outline-none focus:ring-1 ring-pink-200">
                        <span class="text-pink-200 text-[10px]">‚ù§</span>
                        <input type="number" id="hkd-input" oninput="convertCurrency('hkd')" placeholder="$ Ê∏ØÂπ£" class="w-full bg-pink-50 rounded-xl p-1.5 text-[10px] font-black outline-none text-pink-600">
                    </div>
                    <p class="text-[8px] text-gray-400 font-bold tracking-widest uppercase mt-1 text-center">ÂåØÁéá 0.052</p>
                </div>
            </div>

            <!-- Êó•ÊúüÈÅ∏ÊìáÂô® -->
            <div class="flex gap-4 overflow-x-auto no-scrollbar py-3 px-1" id="day-selector"></div>

            <!-- Ë°åÁ®ãË©≥ÊÉÖÂç°Áâá -->
            <div id="day-details" class="bg-white rounded-[3rem] overflow-hidden shadow-2xl shadow-pink-100/50 border border-white relative">
                <div class="cloud-bg"></div>
                
                <div id="day-banner" class="h-64 relative bg-gray-100">
                    <img id="day-img" src="" class="w-full h-full object-cover" onclick="openLightbox(this.src)">
                    <div class="absolute inset-0 img-gradient"></div>
                    <button id="banner-upload-btn" onclick="triggerInput('banner-img-input')" class="hidden absolute top-6 right-6 w-12 h-12 bg-white/30 backdrop-blur-xl rounded-2xl text-white flex items-center justify-center btn-tap shadow-lg">
                        <i class="fas fa-camera text-lg"></i>
                    </button>
                    <div class="absolute bottom-8 left-8 right-8 flex justify-between items-end text-white">
                        <div>
                            <span id="day-label" class="inline-block px-3 py-1 bg-[var(--cute-pink)] rounded-xl text-[10px] font-black mb-2 tracking-widest shadow-md">DAY 1</span>
                            <div id="day-title-container"></div>
                        </div>
                        <div class="text-right">
                            <p class="text-[9px] font-bold opacity-70 tracking-widest mb-1">‰ªäÊó•È†êÁÆó</p>
                            <p id="day-budget" class="text-2xl font-black italic">¬• 0</p>
                        </div>
                    </div>
                </div>
                
                <div class="p-8 relative">
                    <div id="timeline" class="space-y-10 relative min-h-[150px]"></div>
                    <div id="add-event-container" class="hidden mt-10">
                        <button onclick="addEvent()" class="w-full py-5 border-4 border-dashed border-pink-100 rounded-[2rem] text-pink-200 font-black text-xs tracking-widest hover:bg-pink-50 transition-colors">
                            + Êñ∞Â¢ûË°åÁ®ãÊôØÈªû ‚ú®
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Â∑•ÂÖ∑ËàáÊ∏ÖÂñÆÂçÄ -->
        <section id="content-tools" class="hidden space-y-6 animate-pop">
            <!-- ÈáçË¶ÅÊñá‰ª∂ÂúñÁâá -->
            <div class="bg-[var(--jp-ink)] p-8 rounded-[3rem] shadow-xl text-white relative overflow-hidden">
                <div class="cloud-bg opacity-10"></div>
                <div class="flex justify-between items-center mb-8 relative">
                    <div>
                        <h2 class="text-sm font-black tracking-widest uppercase">ÈáçË¶ÅÊñá‰ª∂/Á•®Âà∏</h2>
                        <p class="text-[8px] text-white/40 mt-1 font-bold">TRAVEL DOCUMENTS</p>
                    </div>
                    <button id="add-doc-btn" onclick="triggerInput('lib-file-input')" class="hidden btn-tap px-6 py-3 bg-[var(--cute-pink)] text-white rounded-2xl text-[10px] font-black uppercase shadow-lg">‰∏äÂÇ≥Êñá‰ª∂</button>
                </div>
                <div id="document-list" class="grid grid-cols-2 gap-3 relative"></div>
            </div>

            <!-- Ë°åÊùéÊ∏ÖÂñÆ -->
            <div class="bg-white p-8 rounded-[3rem] border border-pink-50 shadow-sm relative overflow-hidden">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-sm font-black tracking-widest uppercase text-gray-800">Ë°åÊùéÊ∫ñÂÇôÊ∏ÖÂñÆ</h2>
                        <p class="text-[8px] text-pink-300 mt-1 font-bold">PACKING LIST</p>
                    </div>
                    <button id="add-check-btn" onclick="addCheckItem()" class="hidden px-4 py-2 bg-pink-50 text-[10px] font-black text-pink-500 rounded-xl uppercase">+ Êñ∞Â¢û</button>
                </div>
                <div id="checklist" class="space-y-3"></div>
            </div>

            <!-- Â∏∏Áî®ÈÄ£Áµê -->
            <div class="bg-white p-8 rounded-[3rem] border border-pink-50 shadow-sm">
                <h2 class="text-sm font-black tracking-widest uppercase mb-6 text-gray-800">Â∏∏Áî®Âø´Êç∑ÈÄ£Áµê üîó</h2>
                <div id="link-list" class="space-y-3"></div>
                <button id="add-link-btn" onclick="addLink()" class="hidden w-full mt-4 py-3 border-2 border-dashed border-gray-100 rounded-2xl text-[10px] text-gray-400 font-black">+ Êñ∞Â¢ûÈÄ£Áµê</button>
            </div>
        </section>
    </main>

    <!-- Â∫ïÈÉ®Â∞éË¶ΩÊ¨Ñ -->
    <nav class="fixed bottom-8 left-1/2 -translate-x-1/2 w-[90%] max-w-sm glass rounded-[2.5rem] border border-white shadow-2xl z-[100] flex p-2 gap-2 shadow-pink-200/50">
        <button onclick="switchTab('itinerary')" id="tab-itinerary" class="flex-1 py-4 flex flex-col items-center justify-center gap-1 rounded-[2rem] transition-all bg-[var(--jp-ink)] text-white shadow-lg">
            <i class="fas fa-map-marked-alt text-base"></i>
            <span class="text-[9px] font-black tracking-tighter">ÊØèÊó•Ë°åÁ®ã</span>
        </button>
        <button onclick="switchTab('tools')" id="tab-tools" class="flex-1 py-4 flex flex-col items-center justify-center gap-1 rounded-[2rem] transition-all text-gray-400">
            <i class="fas fa-toolbox text-base"></i>
            <span class="text-[9px] font-black tracking-tighter">ÊóÖË°åÂ∑•ÂÖ∑</span>
        </button>
    </nav>

    <script>
        const STORE_KEY = 'SAPPORO_CUTE_V1';
        const exchangeRate = 0.052;
        let currentDayIdx = 0;
        let isEditing = false;
        let activeEventIdx = null;

        const defaultData = {
            itinerary: [
                { date: "2/16", weekday: "‰∏Ä", title: "ÂàùË¶ãÊú≠Âπå ¬∑ Á≤âÈõ™Êº´Ê≠•", img: "https://images.unsplash.com/photo-1542051841857-5f90071e7989?w=800", events: [{ timeFrom: "15:00", timeTo: "16:30", loc: "Êñ∞ÂçÉÊ≠≤Ê©üÂ†¥", desc: "ÊäµÈÅîÂåóÊµ∑ÈÅìÔºåÊ∫ñÂÇôÈü≥Ê®Ç‰πãÊóÖÔºÅ‚ùÑ", cost: 1150, eventImg: "" }] },
                { date: "2/17", weekday: "‰∫å", title: "Èü≥Ê®ÇÊØîË≥Ω ¬∑ Â§¢ÊÉ≥ËàûÂè∞", img: "https://images.unsplash.com/photo-1520529688591-b213eb5ee9a3?w=800", events: [] },
                { date: "2/18", weekday: "‰∏â", title: "Â∞èÊ®ΩÈÅãÊ≤≥ ¬∑ Êµ™Êº´ÁéªÁíÉ", img: "https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?w=800", events: [] },
                { date: "2/19", weekday: "Âõõ", title: "ÊªëÈõ™È´îÈ©ó ¬∑ Èõ™‰∏≠Â•áÁ∑£", img: "https://images.unsplash.com/photo-1454496522488-7a8e488e8606?w=800", events: [] },
                { date: "2/20", weekday: "‰∫î", title: "È†íÁçéÁõõÂÖ∏ ¬∑ ËºùÁÖåÊôÇÂàª", img: "https://images.unsplash.com/photo-1507838596357-01242f2105a9?w=800", events: [] },
                { date: "2/21", weekday: "ÂÖ≠", title: "ÂåóÊµ∑ÈÅìÁæéÈ£ü ¬∑ Â§ßÊêúÊü•", img: "https://images.unsplash.com/photo-1480497490787-505ec076689f?w=800", events: [] },
                { date: "2/22", weekday: "Êó•", title: "ÊúüÂæÖ‰∏ãÊ¨° ¬∑ ÂÜçË¶ãÂÜ¨Êó•", img: "https://images.unsplash.com/photo-1534422298391-e4f8c172dddb?w=800", events: [] }
            ],
            checklist: [{ task: "Ë≠∑ÁÖßËàáÁ∞ΩË≠â", done: true }, { task: "Èò≤ÊªëÈûãÂ¢ä", done: false }, { task: "Â§ßË°£ËàáÊâãÂ•ó", done: false }],
            links: [{ title: "JR ÂåóÊµ∑ÈÅì‰∏≠ÊñáÊôÇÂàªË°®", url: "https://www.jrhokkaido.co.jp/global/chinese/index.html" }],
            documents: []
        };

        let appData = JSON.parse(JSON.stringify(defaultData));

        function triggerInput(id) { document.getElementById(id).click(); }
        function openLightbox(src) { if(!src) return; document.getElementById('lightbox-img').src = src; document.getElementById('lightbox').style.display = 'flex'; }
        function closeLightbox() { document.getElementById('lightbox').style.display = 'none'; }

        async function smartCompress(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (e) => {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let w = img.width, h = img.height;
                        const max = 600;
                        if (w > max) { h = (h * max) / w; w = max; }
                        canvas.width = w; canvas.height = h;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, w, h);
                        resolve(canvas.toDataURL('image/jpeg', 0.35));
                    };
                };
            });
        }

        function showLoading(show) { document.getElementById('loading-overlay').style.display = show ? 'flex' : 'none'; }
        
        function saveData() { 
            try {
                localStorage.setItem(STORE_KEY, JSON.stringify(appData));
            } catch (e) {
                console.warn("Storage quota full.");
            }
        }
        
        function loadData() { 
            const saved = localStorage.getItem(STORE_KEY); 
            if (saved) appData = JSON.parse(saved); 
        }

        // ÈáçË¶ÅÊñá‰ª∂
        document.getElementById('lib-file-input').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            showLoading(true);
            const compressed = await smartCompress(file);
            appData.documents.push({ name: file.name.substring(0,8), data: compressed, date: new Date().toLocaleDateString() });
            saveData(); renderDocuments(); showLoading(false);
        });

        // ÊôØÈªûÁÖßÁâá
        document.getElementById('event-img-input').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file || activeEventIdx === null) return;
            showLoading(true);
            const compressed = await smartCompress(file);
            appData.itinerary[currentDayIdx].events[activeEventIdx].eventImg = compressed;
            saveData(); renderDay(currentDayIdx); showLoading(false);
        });

        // Â∞ÅÈù¢ÁÖßÁâá
        document.getElementById('banner-img-input').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            showLoading(true);
            const compressed = await smartCompress(file);
            appData.itinerary[currentDayIdx].img = compressed;
            saveData(); renderDay(currentDayIdx); showLoading(false);
        });

        function renderDocuments() {
            const container = document.getElementById('document-list'); 
            container.innerHTML = appData.documents.length ? '' : '<div class="col-span-2 text-center py-10 opacity-30 text-[10px] font-black tracking-widest">Êö´ÁÑ°Êñá‰ª∂ ‚ú®</div>';
            appData.documents.forEach((doc, i) => {
                container.innerHTML += `
                <div class="relative group animate-pop">
                    <img src="${doc.data}" class="w-full aspect-square object-cover rounded-3xl border-4 border-white shadow-md" onclick="openLightbox('${doc.data}')">
                    <div class="mt-2 text-center">
                        <p class="text-[9px] font-black truncate text-white/80">${doc.name}</p>
                    </div>
                    ${isEditing ? `<button onclick="appData.documents.splice(${i},1);saveData();renderDocuments();" class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center shadow-lg"><i class="fas fa-times text-[10px]"></i></button>` : ''}
                </div>`;
            });
        }

        function openMap(location) {
            if (!location) return;
            window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(location)}`, '_blank');
        }

        function renderDay(idx) {
            currentDayIdx = idx;
            const day = appData.itinerary[idx];
            document.getElementById('day-img').src = day.img || '';
            document.getElementById('day-label').innerText = `Á¨¨ ${idx + 1} Â§© ¬∑ 2Êúà${day.date.split('/')[1]}Êó•`;
            
            const titleCont = document.getElementById('day-title-container');
            titleCont.innerHTML = isEditing ? 
                `<input type="text" oninput="appData.itinerary[${idx}].title=this.value" value="${day.title}" class="w-full bg-white/20 border-b-2 border-white font-black text-xl outline-none text-white p-1">` : 
                `<h2 class="text-2xl font-black text-white tracking-tight drop-shadow-md">${day.title}</h2>`;

            const totalCost = day.events.reduce((sum, e) => sum + (parseFloat(e.cost) || 0), 0);
            document.getElementById('day-budget').innerText = `¬• ${totalCost.toLocaleString()}`;

            const timeline = document.getElementById('timeline');
            timeline.innerHTML = `<div class="timeline-line"></div>`;
            
            day.events.forEach((ev, i) => {
                if (isEditing) {
                    timeline.innerHTML += `
                    <div class="relative pl-12 bg-pink-50/50 p-6 rounded-[2rem] border-2 border-dashed border-pink-100 animate-pop">
                        <div class="flex gap-2 mb-3">
                            <input type="time" oninput="appData.itinerary[${idx}].events[${i}].timeFrom=this.value" value="${ev.timeFrom||''}" class="flex-1 text-[11px] p-2 bg-white rounded-xl border border-pink-50 font-bold">
                            <input type="number" oninput="appData.itinerary[${idx}].events[${i}].cost=this.value" value="${ev.cost}" placeholder="¬• Ë≤ªÁî®" class="w-20 text-[11px] p-2 bg-white border border-pink-50 rounded-xl font-black">
                        </div>
                        <input type="text" oninput="appData.itinerary[${idx}].events[${i}].loc=this.value" value="${ev.loc}" placeholder="Âú∞ÈªûÂêçÁ®±" class="w-full text-xs font-black mb-3 p-2 bg-white border border-pink-50 rounded-xl">
                        <textarea oninput="appData.itinerary[${idx}].events[${i}].desc=this.value" placeholder="Ë£úÂÖÖÂÇôË®ª..." class="w-full text-[10px] p-2 bg-white border border-pink-50 rounded-xl mb-3 outline-none">${ev.desc||''}</textarea>
                        <div class="flex gap-6">
                            <button onclick="activeEventIdx=${i};triggerInput('event-img-input')" class="text-[10px] font-black text-blue-400"><i class="fas fa-image mr-1"></i> ÂÇ≥ÁÖßÁâá</button>
                            <button onclick="appData.itinerary[${idx}].events.splice(${i},1);renderDay(${idx})" class="text-[10px] font-black text-red-400"><i class="fas fa-trash-alt mr-1"></i> Âà™Èô§</button>
                        </div>
                    </div>`;
                } else {
                    timeline.innerHTML += `
                    <div class="relative pl-12 animate-pop">
                        <div class="timeline-dot"></div>
                        <div class="flex flex-col gap-1">
                            <p class="text-[10px] font-black text-pink-200 tracking-widest uppercase">${ev.timeFrom || '--:--'} ‚ú®</p>
                            <div class="flex justify-between items-start">
                                <h3 onclick="openMap('${ev.loc}')" class="font-black text-lg text-gray-800 active:text-[var(--cute-pink)] leading-snug">${ev.loc}</h3>
                                <button onclick="openMap('${ev.loc}')" class="btn-tap shrink-0 w-10 h-10 bg-blue-50 text-blue-400 rounded-2xl flex items-center justify-center shadow-sm">
                                    <i class="fas fa-location-arrow text-xs"></i>
                                </button>
                            </div>
                            <p class="text-xs text-gray-500 leading-relaxed mt-1">${ev.desc || 'Â∞öÁÑ°ÂÇôË®ª'}</p>
                            <div class="flex items-center gap-2 mt-2">
                                <span class="px-2 py-0.5 tag-pink rounded-lg text-[9px] font-bold">Ëä±Ë≤ª: ¬• ${(ev.cost || 0).toLocaleString()}</span>
                            </div>
                            ${ev.eventImg ? `<div class="mt-4 rounded-[2rem] overflow-hidden shadow-lg border-4 border-white"><img src="${ev.eventImg}" class="w-full h-44 object-cover" onclick="openLightbox('${ev.eventImg}')"></div>` : ''}
                        </div>
                    </div>`;
                }
            });
            document.querySelectorAll('.day-card').forEach((el, i) => el.classList.toggle('active', i === idx));
        }

        function renderChecklist() {
            const list = document.getElementById('checklist'); list.innerHTML = '';
            appData.checklist.forEach((item, i) => {
                list.innerHTML += `
                <div class="flex items-center gap-4 p-5 rounded-[1.8rem] ${item.done ? 'bg-gray-50/50 opacity-60' : 'bg-pink-50/30'} animate-pop" onclick="${!isEditing ? `appData.checklist[${i}].done=!appData.checklist[${i}].done;saveData();renderChecklist()` : ''}">
                    <div class="w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all ${item.done ? 'bg-green-400 border-transparent text-white' : 'border-pink-100 bg-white'}">
                        ${item.done ? '<i class="fas fa-check text-[10px]"></i>' : ''}
                    </div>
                    <div class="flex-1">
                        ${isEditing ? `<input value="${item.task}" oninput="appData.checklist[${i}].task=this.value" class="w-full text-xs font-black bg-transparent outline-none text-gray-700">` : `<span class="text-xs font-black text-gray-700 ${item.done ? 'line-through opacity-30' : ''}">${item.task}</span>`}
                    </div>
                    ${isEditing ? `<button onclick="appData.checklist.splice(${i},1);renderChecklist()" class="text-red-300 px-2"><i class="fas fa-heart-broken text-sm"></i></button>` : ''}
                </div>`;
            });
        }

        function renderLinks() {
            const list = document.getElementById('link-list'); list.innerHTML = '';
            appData.links.forEach((l, i) => {
                list.innerHTML += `
                <div class="flex gap-2">
                    <a href="${l.url}" target="_blank" class="flex-1 p-5 bg-blue-50/30 rounded-2xl text-[11px] font-black text-blue-500 flex justify-between items-center shadow-sm">
                        ${isEditing ? `<input value="${l.title}" oninput="appData.links[${i}].title=this.value" class="bg-transparent outline-none w-full" onclick="event.preventDefault()">` : `<span>${l.title}</span>`}
                        <i class="fas fa-chevron-right text-[10px] opacity-30"></i>
                    </a>
                    ${isEditing ? `<button onclick="appData.links.splice(${i},1);renderLinks()" class="px-3 text-red-300"><i class="fas fa-trash-alt text-sm"></i></button>` : ''}
                </div>`;
            });
        }

        function toggleEdit() {
            isEditing = !isEditing;
            const btn = document.getElementById('edit-btn');
            btn.innerText = isEditing ? 'ÂÆåÊàêÂÑ≤Â≠ò' : 'Á∑®ËºØË°åÁ®ã';
            btn.classList.toggle('bg-green-500', isEditing);
            btn.classList.toggle('bg-[var(--jp-ink)]', !isEditing);
            ['add-event-container', 'banner-upload-btn', 'add-doc-btn', 'add-link-btn', 'add-check-btn'].forEach(id => document.getElementById(id).classList.toggle('hidden', !isEditing));
            if (!isEditing) saveData();
            renderDay(currentDayIdx); renderChecklist(); renderDocuments(); renderLinks();
        }

        function switchTab(tab) {
            document.getElementById('content-itinerary').classList.toggle('hidden', tab !== 'itinerary');
            document.getElementById('content-tools').classList.toggle('hidden', tab !== 'tools');
            const btnItin = document.getElementById('tab-itinerary');
            const btnTools = document.getElementById('tab-tools');
            if (tab === 'itinerary') {
                btnItin.classList.add('bg-[var(--jp-ink)]', 'text-white', 'shadow-lg'); btnItin.classList.remove('text-gray-400');
                btnTools.classList.remove('bg-[var(--jp-ink)]', 'text-white', 'shadow-lg'); btnTools.classList.add('text-gray-400');
            } else {
                btnTools.classList.add('bg-[var(--jp-ink)]', 'text-white', 'shadow-lg'); btnTools.classList.remove('text-gray-400');
                btnItin.classList.remove('bg-[var(--jp-ink)]', 'text-white', 'shadow-lg'); btnItin.classList.add('text-gray-400');
            }
        }

        function convertCurrency(type) { 
            const jpy = document.getElementById('jpy-input'), hkd = document.getElementById('hkd-input'); 
            if (type === 'jpy') hkd.value = (jpy.value * exchangeRate).toFixed(2); 
            else jpy.value = (hkd.value / exchangeRate).toFixed(0); 
        }

        async function fetchWeather() {
            try {
                const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=43.0667&longitude=141.35&current_weather=true');
                const data = await res.json();
                document.getElementById('weather-display').innerText = `${Math.round(data.current_weather.temperature)}¬∞C Êú≠Âπå`;
            } catch (e) { document.getElementById('weather-display').innerText = '-2¬∞C Êú≠Âπå'; }
        }

        function initDaySelector() {
            const s = document.getElementById('day-selector'); s.innerHTML = '';
            appData.itinerary.forEach((day, i) => {
                s.innerHTML += `
                <button onclick="renderDay(${i})" class="day-card btn-tap flex-shrink-0 w-16 h-24 rounded-[2rem] flex flex-col items-center justify-center bg-white border border-pink-50 shadow-sm transition-all">
                    <span class="text-[8px] font-black opacity-30 uppercase tracking-widest">2Êúà</span>
                    <span class="text-lg font-black">${day.date.split('/')[1]}</span>
                    <span class="text-[8px] font-bold opacity-30 mt-1">ÈÄ±${day.weekday}</span>
                </button>`;
            });
        }

        function resetData() { if (confirm("Á¢∫ÂÆöË¶ÅÈáçË®≠ÊâÄÊúâË≥áÊñôÂóéÔºü(Ê≠§Âãï‰ΩúÁÑ°Ê≥ïÂæ©Âéü)")) { localStorage.removeItem(STORE_KEY); location.reload(); } }
        function addEvent() { appData.itinerary[currentDayIdx].events.push({ timeFrom: "09:00", loc: "Êñ∞ÊôØÈªûÂêçÁ®±", desc: "", cost: 0, eventImg: "" }); renderDay(currentDayIdx); }
        function addCheckItem() { appData.checklist.push({ task: "Êñ∞Ê∫ñÂÇôÈ†ÖÁõÆ", done: false }); renderChecklist(); }
        function addLink() { appData.links.push({ title: "Êñ∞Á∂≤ÂùÄÈÄ£Áµê", url: "https://" }); renderLinks(); }

        window.onload = () => { loadData(); initDaySelector(); renderDay(0); renderChecklist(); renderDocuments(); renderLinks(); fetchWeather(); };
    </script>
</body>
</html>
