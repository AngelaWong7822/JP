<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sapporo 2026 | AI 旅遊助手</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .glass { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); }
        .day-card.active { background: #2D3436; color: white; transform: translateY(-4px); opacity: 1; box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.2); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade { animation: fadeIn 0.4s ease-out forwards; }
        .img-gradient { background: linear-gradient(to bottom, transparent 40%, rgba(0,0,0,0.7)); }
    </style>
</head>
<body class="bg-[#F8F9FA] text-[#2D3436] pb-24">

    <!-- Hidden File Input for reuse -->
    <input type="file" id="global-file-input" class="hidden" accept="image/*">
    <input type="file" id="doc-file-input" class="hidden" accept="application/pdf,image/*">

    <!-- Header -->
    <header class="sticky top-0 z-50 glass border-b border-gray-100 p-4 flex justify-between items-center">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-gradient-to-br from-[#FF7675] to-[#D63031] rounded-xl flex items-center justify-center text-white shadow-lg">
                <i class="fas fa-music"></i>
            </div>
            <div>
                <h1 class="text-sm font-black tracking-tight leading-none mb-1">Sapporo 2026</h1>
                <p class="text-[9px] font-bold text-gray-400 uppercase tracking-widest flex items-center gap-1">
                    <i class="fas fa-snowflake text-blue-300"></i> AI Travel Companion
                </p>
            </div>
        </div>
        <div class="flex gap-2">
            <button onclick="resetData()" class="px-2 py-2 text-gray-400 hover:text-red-500 text-xs transition-colors">
                <i class="fas fa-undo"></i>
            </button>
            <button id="edit-btn" onclick="toggleEdit()" class="px-4 py-2 bg-[#2D3436] text-white rounded-xl font-black text-[11px] transition-all shadow-md flex items-center gap-1.5">
                <i class="fas fa-edit"></i> <span>編輯模式</span>
            </button>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="flex px-6 pt-4 gap-8 border-b border-gray-100 bg-white">
        <button onclick="switchTab('itinerary')" id="tab-itinerary" class="pb-3 text-[10px] font-black uppercase tracking-widest transition-all relative text-[#2D3436]">
            行程規劃
            <div id="ind-itinerary" class="active-indicator absolute bottom-0 left-0 right-0 h-1 bg-[#FF7675] rounded-full"></div>
        </button>
        <button onclick="switchTab('tools')" id="tab-tools" class="pb-3 text-[10px] font-black uppercase tracking-widest transition-all relative text-gray-300">
            清單與文件
            <div id="ind-tools" class="active-indicator hidden absolute bottom-0 left-0 right-0 h-1 bg-[#FF7675] rounded-full"></div>
        </button>
    </nav>

    <main class="p-4 max-w-2xl mx-auto space-y-6">
        
        <!-- Tab Content: Itinerary -->
        <section id="content-itinerary" class="space-y-6">
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-white p-4 rounded-3xl border border-gray-100 shadow-sm flex items-center justify-between">
                    <div>
                        <p class="text-[9px] font-black text-gray-400 uppercase">Sapporo Temp</p>
                        <p class="text-sm font-black">-2°C / ❄️ 降雪中</p>
                    </div>
                    <i class="fas fa-snowflake text-blue-200 text-xl"></i>
                </div>
                <div class="bg-white p-4 rounded-3xl border border-gray-100 shadow-sm">
                    <p class="text-[9px] font-black text-gray-400 uppercase mb-2">匯率換算 (0.052)</p>
                    <div class="flex gap-2">
                        <input type="number" id="jpy-input" oninput="convertCurrency('jpy')" placeholder="¥" class="w-full bg-gray-50 rounded-lg p-1 text-xs font-black outline-none">
                        <input type="number" id="hkd-input" oninput="convertCurrency('hkd')" placeholder="$" class="w-full bg-blue-50/50 rounded-lg p-1 text-xs font-black outline-none text-blue-600">
                    </div>
                </div>
            </div>

            <div class="flex gap-3 overflow-x-auto no-scrollbar py-2" id="day-selector"></div>

            <div id="day-details" class="rounded-[2.5rem] p-0 overflow-hidden shadow-xl border border-gray-100 transition-all duration-500 bg-white">
                <div id="day-banner" class="h-48 bg-gray-200 relative">
                    <img id="day-img" src="" class="w-full h-full object-cover" onerror="this.src='https://images.unsplash.com/photo-1542051841857-5f90071e7989?q=80&w=1000&auto=format&fit=crop'">
                    <div class="absolute inset-0 img-gradient"></div>
                    
                    <button id="banner-upload-btn" onclick="triggerFileUpload('banner')" class="hidden absolute top-4 right-4 w-10 h-10 bg-white/20 backdrop-blur-md border border-white/30 rounded-full text-white flex items-center justify-center hover:bg-white/40 transition-all">
                        <i class="fas fa-camera"></i>
                    </button>

                    <div class="absolute bottom-6 left-8 right-8 flex justify-between items-end text-white">
                        <div>
                            <span id="day-label" class="inline-block px-3 py-0.5 bg-white/20 backdrop-blur-md rounded-full text-[9px] font-black uppercase mb-2">Day 1</span>
                            <div id="day-title-container">
                                <h2 id="day-title" class="text-2xl font-black leading-tight">載入中...</h2>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-[9px] font-bold opacity-70 uppercase">當日總支出</p>
                            <p id="day-budget" class="text-lg font-black tracking-tight">¥ 0</p>
                        </div>
                    </div>
                </div>
                
                <div class="p-8">
                    <div id="timeline" class="space-y-10 relative"></div>
                    <div id="add-event-container" class="hidden mt-10">
                        <button onclick="addEvent()" class="w-full py-4 border-2 border-dashed border-gray-200 rounded-3xl text-gray-400 font-black text-xs hover:bg-gray-50 hover:border-[#FF7675] hover:text-[#FF7675] transition-all">
                            <i class="fas fa-plus mr-2"></i> 新增行程點
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tab Content: Tools -->
        <section id="content-tools" class="hidden space-y-6">
            
            <!-- Quick Links -->
            <div class="bg-white p-6 rounded-[2.5rem] border border-gray-100 shadow-sm">
                <div class="flex justify-between items-center mb-6">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 bg-blue-100 rounded-xl flex items-center justify-center">
                            <i class="fas fa-link text-blue-500 text-sm"></i>
                        </div>
                        <h2 class="text-xl font-black tracking-tight">快速連結</h2>
                    </div>
                    <button id="add-link-btn" onclick="addLink()" class="hidden px-4 py-2 bg-blue-50 text-blue-600 rounded-xl text-[10px] font-black">
                        <i class="fas fa-plus mr-1"></i> 新增連結
                    </button>
                </div>
                <div id="link-list" class="grid grid-cols-1 gap-3"></div>
            </div>

            <!-- PDF / Documents Storage -->
            <div class="bg-[#2D3436] p-6 rounded-[2.5rem] shadow-xl text-white">
                <div class="flex justify-between items-center mb-6">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 bg-white/10 rounded-xl flex items-center justify-center">
                            <i class="fas fa-file-pdf text-red-400 text-sm"></i>
                        </div>
                        <h2 class="text-xl font-black tracking-tight text-white">重要文件庫</h2>
                    </div>
                    <button id="add-doc-btn" onclick="document.getElementById('doc-file-input').click()" class="hidden px-4 py-2 bg-white/10 text-white rounded-xl text-[10px] font-black border border-white/20">
                        <i class="fas fa-upload mr-1"></i> 上傳 PDF/圖片
                    </button>
                </div>
                <div id="document-list" class="space-y-3"></div>
            </div>

            <!-- Checklist -->
            <div class="bg-white p-6 rounded-[2.5rem] border border-gray-100 shadow-sm">
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-8 h-8 bg-orange-100 rounded-xl flex items-center justify-center">
                        <i class="fas fa-clipboard-list text-orange-500 text-sm"></i>
                    </div>
                    <h2 class="text-xl font-black tracking-tight">準備清單</h2>
                </div>
                <div id="checklist" class="space-y-3"></div>
            </div>

            <!-- Photo Gallery -->
            <div class="bg-white p-6 rounded-[2.5rem] border border-gray-100 shadow-sm">
                <div class="flex justify-between items-center mb-6">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 bg-purple-100 rounded-xl flex items-center justify-center">
                            <i class="fas fa-camera-retro text-purple-500 text-sm"></i>
                        </div>
                        <h2 class="text-xl font-black tracking-tight">旅途回憶錄</h2>
                    </div>
                    <button id="add-photo-btn" onclick="triggerFileUpload('gallery')" class="hidden px-4 py-2 bg-purple-50 text-purple-600 rounded-xl text-[10px] font-black shadow-sm">
                        <i class="fas fa-upload mr-1"></i> 上傳照片
                    </button>
                </div>
                <div id="photo-gallery" class="grid grid-cols-2 gap-3"></div>
            </div>
        </section>
    </main>

    <script>
        const STORE_KEY = 'SAPPORO_2026_V2_STORAGE';
        const exchangeRate = 0.052;
        let currentDay = 0;
        let isEditing = false;
        let uploadTarget = null;

        const defaultData = {
            itinerary: [
                { 
                    date: "2/16", weekday: "MON", title: "抵達札幌 · 壽司之夜", 
                    img: "https://images.unsplash.com/photo-1579871494447-9811cf80d66c?w=1000",
                    events: [
                        { time: "15:00", loc: "新千歲機場", desc: "搭乘快速 Airport 號。", icon: "fa-train", color: "text-blue-500", cost: 1150, img: "" },
                        { time: "20:30", loc: "鮨 棗 (Sushi Natsume)", desc: "Akarenga Terrace 3F 頂級壽司。", icon: "fa-utensils", color: "text-rose-500", cost: 15000, img: "https://images.unsplash.com/photo-1553621042-f6e147245754?w=600" }
                    ]
                },
                { 
                    date: "2/17", weekday: "TUE", title: "音樂決賽日 @ Sun Plaza", 
                    img: "https://images.unsplash.com/photo-1520527057852-44c0e5f5824c?w=1000",
                    events: [
                        { time: "10:00", loc: "Sapporo Sun Plaza", desc: "舞台試琴與音樂決賽。", icon: "fa-music", color: "text-purple-500", cost: 0, img: "" }
                    ]
                },
                { date: "2/18", weekday: "WED", title: "小樽浪漫散策", img: "https://images.unsplash.com/photo-1590559899731-a3828dfc385a?w=1000", events: [{ time: "10:00", loc: "小樽運河", desc: "漫步玻璃工坊與運河景觀。", icon: "fa-camera", color: "text-green-500", cost: 0, img: "" }] },
                { date: "2/19", weekday: "THU", title: "二条市場與電視塔", img: "https://images.unsplash.com/photo-1574104269864-67293a77864c?w=1000", events: [{ time: "09:00", loc: "二条市場", desc: "海鮮丼早餐。", icon: "fa-utensils", color: "text-orange-500", cost: 3000, img: "" }] },
                { date: "2/20", weekday: "FRI", title: "白色戀人公園", img: "https://images.unsplash.com/photo-1542051841857-5f90071e7989?w=1000", events: [{ time: "14:00", loc: "白色戀人工廠", desc: "體驗製作餅乾。", icon: "fa-cookie-bite", color: "text-amber-500", cost: 1000, img: "" }] },
                { date: "2/21", weekday: "SAT", title: "大通公園與購物", img: "https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?w=1000", events: [{ time: "11:00", loc: "大通公園", desc: "賞雪雕作品。", icon: "fa-snowman", color: "text-blue-300", cost: 0, img: "" }] },
                { date: "2/22", weekday: "SUN", title: "最後衝刺 · 賦歸", img: "https://images.unsplash.com/photo-1531058020387-3be344556be6?w=1000", events: [{ time: "10:00", loc: "新千歲機場免稅店", desc: "購買伴手禮。", icon: "fa-shopping-bag", color: "text-pink-500", cost: 0, img: "" }] }
            ],
            checklist: [
                { task: "比賽用樂譜 & 正裝", done: false },
                { task: "暖暖包 / 防滑鞋墊", done: true },
                { task: "護照 & 保險文件", done: true },
                { task: "日本上網卡 (eSIM)", done: false }
            ],
            links: [
                { title: "鮨 棗 官網", url: "https://www.sushi-natsume.com/" }
            ],
            photos: [],
            documents: []
        };

        let appData = JSON.parse(JSON.stringify(defaultData));

        function saveData() { 
            try { localStorage.setItem(STORE_KEY, JSON.stringify(appData)); } catch (e) {
                if (e.name === 'QuotaExceededError') alert('空間不足！請移除部分照片或PDF檔案。');
            }
        }
        
        function loadData() {
            const saved = localStorage.getItem(STORE_KEY);
            if (saved) { try { appData = JSON.parse(saved); } catch (e) { console.error(e); } }
        }

        // --- 檔案上傳與PDF處理 ---
        function triggerFileUpload(target, extraInfo = null) {
            uploadTarget = { type: target, extra: extraInfo };
            document.getElementById('global-file-input').click();
        }

        document.getElementById('global-file-input').addEventListener('change', handleFile);
        document.getElementById('doc-file-input').addEventListener('change', (e) => handleFile(e, true));

        function handleFile(e, isDoc = false) {
            const file = e.target.files[0];
            if (!file) return;
            if (file.size > 2 * 1024 * 1024) { alert("檔案太大！請限制在 2MB 以內。"); return; }
            const reader = new FileReader();
            reader.onload = (event) => {
                const base64 = event.target.result;
                if (isDoc) {
                    appData.documents.push({ name: file.name, data: base64, date: new Date().toLocaleDateString() });
                    renderDocuments();
                } else {
                    handleUploadSuccess(base64);
                }
                saveData();
            };
            reader.readAsDataURL(file);
            e.target.value = '';
        }

        function handleUploadSuccess(base64) {
            if (uploadTarget.type === 'banner') appData.itinerary[currentDay].img = base64;
            else if (uploadTarget.type === 'event') appData.itinerary[uploadTarget.extra.dayIdx].events[uploadTarget.extra.eventIdx].img = base64;
            else if (uploadTarget.type === 'gallery') appData.photos.push({ url: base64, caption: "旅途片段" });
            renderDay(currentDay);
            renderPhotos();
        }

        function toggleEdit() {
            isEditing = !isEditing;
            const btn = document.getElementById('edit-btn');
            btn.innerHTML = isEditing ? '<i class="fas fa-check"></i> 儲存' : '<i class="fas fa-edit"></i> 編輯模式';
            btn.className = isEditing ? "px-4 py-2 bg-green-500 text-white rounded-xl font-black text-[11px] shadow-md transition-all" : "px-4 py-2 bg-[#2D3436] text-white rounded-xl font-black text-[11px] shadow-md transition-all";
            
            document.getElementById('add-event-container').classList.toggle('hidden', !isEditing);
            document.getElementById('add-link-btn').classList.toggle('hidden', !isEditing);
            document.getElementById('add-photo-btn').classList.toggle('hidden', !isEditing);
            document.getElementById('banner-upload-btn').classList.toggle('hidden', !isEditing);
            document.getElementById('add-doc-btn').classList.toggle('hidden', !isEditing);
            
            if (!isEditing) saveData();
            renderDay(currentDay);
            renderLinks();
            renderChecklist();
            renderPhotos();
            renderDocuments();
        }

        function renderDocuments() {
            const container = document.getElementById('document-list');
            container.innerHTML = '';
            appData.documents.forEach((doc, i) => {
                container.innerHTML += `
                    <div class="flex items-center gap-3 p-4 bg-white/10 rounded-2xl border border-white/5 animate-fade">
                        <div class="w-10 h-10 flex-shrink-0 bg-red-400/20 rounded-xl flex items-center justify-center text-red-400">
                            <i class="fas ${doc.name.toLowerCase().endsWith('.pdf') ? 'fa-file-pdf' : 'fa-image'} text-lg"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h4 class="text-sm font-bold truncate">${doc.name}</h4>
                            <p class="text-[9px] text-white/40 uppercase font-bold">${doc.date}</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="viewDoc('${doc.data}')" class="w-8 h-8 rounded-lg bg-white/10 flex items-center justify-center hover:bg-white/20">
                                <i class="fas fa-eye text-xs"></i>
                            </button>
                            ${isEditing ? `<button onclick="appData.documents.splice(${i},1);renderDocuments();saveData();" class="w-8 h-8 rounded-lg bg-red-500/20 text-red-400 flex items-center justify-center">
                                <i class="fas fa-trash text-xs"></i>
                            </button>` : ''}
                        </div>
                    </div>`;
            });
            if (appData.documents.length === 0) container.innerHTML = `<div class="py-4 text-center text-white/20 text-[10px] font-bold border-2 border-dashed border-white/5 rounded-2xl">尚無上傳文件</div>`;
        }

        function viewDoc(base64) {
            const win = window.open();
            win.document.write(`<iframe src="${base64}" frameborder="0" style="border:0; top:0px; left:0px; bottom:0px; right:0px; width:100%; height:100%;" allowfullscreen></iframe>`);
        }

        function renderDay(idx) {
            currentDay = idx;
            const day = appData.itinerary[idx];
            if (!day) return;
            document.getElementById('day-img').src = day.img || '';
            document.getElementById('day-label').innerText = `Day ${idx + 1}`;
            document.getElementById('day-title-container').innerHTML = isEditing ? 
                `<input type="text" oninput="appData.itinerary[${idx}].title=this.value" value="${day.title}" class="w-full bg-white/20 border-b border-white font-black text-xl outline-none text-white">` : 
                `<h2 class="text-2xl font-black text-white">${day.title}</h2>`;

            const totalCost = day.events.reduce((sum, e) => sum + (parseInt(e.cost) || 0), 0);
            document.getElementById('day-budget').innerText = `¥ ${totalCost.toLocaleString()}`;

            const timeline = document.getElementById('timeline');
            timeline.innerHTML = `<div class="absolute left-[15px] top-2 bottom-2 w-px bg-gray-100"></div>`;
            day.events.forEach((event, i) => {
                if (isEditing) {
                    timeline.innerHTML += `<div class="relative pl-10 bg-gray-50 p-4 rounded-3xl border border-gray-100 mb-6 animate-fade">
                        <div class="flex gap-2 mb-2">
                            <input type="text" oninput="appData.itinerary[${idx}].events[${i}].time=this.value" value="${event.time}" placeholder="時間" class="w-20 text-[10px] p-1 border rounded">
                            <input type="number" oninput="appData.itinerary[${idx}].events[${i}].cost=this.value" value="${event.cost}" placeholder="費用" class="w-24 text-[10px] p-1 border rounded">
                        </div>
                        <input type="text" oninput="appData.itinerary[${idx}].events[${i}].loc=this.value" value="${event.loc}" class="w-full text-sm font-black mb-3 p-2 rounded-lg border">
                        <button onclick="triggerFileUpload('event', {dayIdx:${idx}, eventIdx:${i}})" class="w-full py-2 bg-white border rounded-xl text-[10px] mb-2"><i class="fas fa-camera mr-1"></i>上傳行程圖</button>
                        <textarea oninput="appData.itinerary[${idx}].events[${i}].desc=this.value" class="w-full text-[10px] p-2 rounded-lg border h-16">${event.desc}</textarea>
                        <button onclick="appData.itinerary[${idx}].events.splice(${i},1);renderDay(${idx})" class="text-red-400 text-[10px] font-bold mt-2">移除</button>
                    </div>`;
                } else {
                    timeline.innerHTML += `<div class="relative pl-12 animate-fade">
                        <div class="absolute left-0 top-1 w-8 h-8 bg-white border border-gray-100 shadow-sm rounded-xl flex items-center justify-center z-10 ${event.color}"><i class="fas ${event.icon} text-xs"></i></div>
                        <div class="flex flex-col gap-3">
                            <div>
                                <div class="flex items-center gap-2 mb-1"><span class="text-[10px] font-black text-gray-400">${event.time}</span></div>
                                <h3 class="font-black text-[#2D3436] text-base">${event.loc}</h3>
                                <p class="text-xs text-gray-500 mt-1">${event.desc}</p>
                            </div>
                            ${event.img ? `<img src="${event.img}" class="w-full h-40 object-cover rounded-3xl shadow-md">` : ''}
                        </div>
                    </div>`;
                }
            });
            document.querySelectorAll('.day-card').forEach((el, i) => el.classList.toggle('active', i === idx));
        }

        function renderPhotos() {
            const gallery = document.getElementById('photo-gallery');
            gallery.innerHTML = '';
            appData.photos.forEach((p, i) => {
                gallery.innerHTML += `<div class="group relative rounded-3xl overflow-hidden shadow-sm animate-fade aspect-square">
                    <img src="${p.url}" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col justify-end p-3">
                        ${isEditing ? `<button onclick="appData.photos.splice(${i},1);renderPhotos();saveData();" class="bg-red-500 text-white rounded-xl py-1 text-[9px] font-black">刪除</button>` : `<p class="text-white text-[10px] font-black truncate">${p.caption}</p>`}
                    </div>
                </div>`;
            });
        }

        function renderChecklist() {
            const list = document.getElementById('checklist');
            list.innerHTML = '';
            appData.checklist.forEach((item, i) => {
                list.innerHTML += `<div class="flex items-center gap-3 p-4 rounded-2xl border ${item.done && !isEditing ? 'bg-gray-50 border-transparent opacity-60' : 'bg-white border-gray-100 shadow-sm'}" onclick="${!isEditing ? `appData.checklist[${i}].done=!appData.checklist[${i}].done;saveData();renderChecklist()` : ''}">
                    <div class="w-6 h-6 rounded-lg flex items-center justify-center border-2 ${item.done ? 'bg-orange-500 border-orange-500 text-white' : 'border-gray-200'}">${item.done ? '<i class="fas fa-check text-xs"></i>' : ''}</div>
                    <div class="flex-1">${isEditing ? `<input type="text" oninput="appData.checklist[${i}].task=this.value" value="${item.task}" class="w-full text-sm font-bold bg-transparent outline-none">` : `<span class="text-sm font-bold ${item.done ? 'line-through text-gray-400' : ''}">${item.task}</span>`}</div>
                    ${isEditing ? `<button onclick="appData.checklist.splice(${i},1);renderChecklist()" class="text-red-300"><i class="fas fa-trash-alt"></i></button>` : ''}
                </div>`;
            });
            if(isEditing) list.innerHTML += `<button onclick="appData.checklist.push({task:'新項目',done:false});renderChecklist()" class="w-full py-4 border-2 border-dashed border-gray-100 rounded-2xl text-gray-400 font-bold text-xs">+ 新增準備項</button>`;
        }

        function renderLinks() {
            const list = document.getElementById('link-list');
            list.innerHTML = '';
            appData.links.forEach((link, i) => {
                if (isEditing) {
                    list.innerHTML += `<div class="bg-gray-50 p-4 rounded-2xl border flex gap-3"><input type="text" oninput="appData.links[${i}].title=this.value" value="${link.title}" class="flex-1 text-xs p-2 rounded-lg border"><input type="text" oninput="appData.links[${i}].url=this.value" value="${link.url}" class="flex-1 text-xs p-2 rounded-lg border text-blue-500"><button onclick="appData.links.splice(${i},1);renderLinks()"><i class="fas fa-trash text-red-300"></i></button></div>`;
                } else {
                    list.innerHTML += `<a href="${link.url.startsWith('http') ? link.url : 'https://'+link.url}" target="_blank" class="bg-white p-4 rounded-2xl border border-gray-100 flex justify-between items-center shadow-sm"><div class="flex items-center gap-3"><span class="text-sm font-black text-gray-700">${link.title}</span></div><i class="fas fa-external-link-alt text-gray-300 text-[10px]"></i></a>`;
                }
            });
        }

        function switchTab(tab) {
            document.getElementById('content-itinerary').classList.toggle('hidden', tab !== 'itinerary');
            document.getElementById('content-tools').classList.toggle('hidden', tab !== 'tools');
            document.getElementById('ind-itinerary').classList.toggle('hidden', tab !== 'itinerary');
            document.getElementById('ind-tools').classList.toggle('hidden', tab !== 'tools');
        }

        function addEvent() { appData.itinerary[currentDay].events.push({ time: "12:00", loc: "新景點", desc: "行程描述", icon: "fa-map-pin", color: "text-blue-500", cost: 0, img: "" }); renderDay(currentDay); }
        function addLink() { appData.links.push({ title: "新連結", url: "" }); renderLinks(); }
        function convertCurrency(type) { const jpy = document.getElementById('jpy-input'); const hkd = document.getElementById('hkd-input'); if (type === 'jpy') hkd.value = jpy.value ? (jpy.value * exchangeRate).toFixed(2) : ''; else jpy.value = hkd.value ? (hkd.value / exchangeRate).toFixed(0) : ''; }
        function initDaySelector() { const s = document.getElementById('day-selector'); s.innerHTML = ''; appData.itinerary.forEach((day, i) => { s.innerHTML += `<button onclick="renderDay(${i})" class="day-card flex-shrink-0 w-16 h-20 rounded-2xl flex flex-col items-center justify-center bg-white shadow-sm transition-all border">Feb<br><span class="text-xl font-black">${day.date.split('/')[1]}</span></button>`; }); }

        window.onload = () => { loadData(); initDaySelector(); renderDay(0); renderLinks(); renderChecklist(); renderPhotos(); renderDocuments(); };
        function resetData() { if (confirm("確定要重設為預設資料嗎？（這將清空你自訂的 2/18-2/22 行程）")) { localStorage.removeItem(STORE_KEY); location.reload(); } }
    </script>
</body>
</html>